
///////////////////////////////////////////////////////////////////////////////
//
//  Copyright (c) 2019, Perry L Miller IV
//  All rights reserved.
//  MIT License: https://opensource.org/licenses/mit-license.html
//
///////////////////////////////////////////////////////////////////////////////

///////////////////////////////////////////////////////////////////////////////
//
//  Map of properties.
//
///////////////////////////////////////////////////////////////////////////////

#include "Usul/Properties/Map.h"
#include "Usul/Tools/NoThrow.h"

#include <functional>


namespace Usul {
namespace Properties {


///////////////////////////////////////////////////////////////////////////////
//
//  Constructors
//
///////////////////////////////////////////////////////////////////////////////

Map::Map() :
  _values()
{
}
Map::Map ( const Map &m ) :
  _values ( m._values )
{
}
Map::Map ( const Map::Values &values ) :
  _values ( values )
{
}


///////////////////////////////////////////////////////////////////////////////
//
//  Destructor
//
///////////////////////////////////////////////////////////////////////////////

Map::~Map()
{
  USUL_TOOLS_NO_THROW ( std::bind ( &Map::_destroyMap, this ) );
}


///////////////////////////////////////////////////////////////////////////////
//
//  Assignment
//
///////////////////////////////////////////////////////////////////////////////

Map &Map::operator = ( const Map &m )
{
  _values = m._values;
  return *this;
}
Map &Map::operator = ( const Map::Values &values )
{
  _values = values;
  return *this;
}


///////////////////////////////////////////////////////////////////////////////
//
//  Destroy
//
///////////////////////////////////////////////////////////////////////////////

void Map::_destroyMap()
{
  _values.clear();
}


///////////////////////////////////////////////////////////////////////////////
//
//  Get the property object.
//
///////////////////////////////////////////////////////////////////////////////

const Map::Object *Map::object ( const std::string &name ) const
{
  Values::const_iterator i = _values.find ( name );
  return ( ( _values.end() == i ) ? nullptr : i->second.get() );
}


///////////////////////////////////////////////////////////////////////////////
//
//  Clear the map.
//
///////////////////////////////////////////////////////////////////////////////

void Map::clear()
{
  _values.clear();
}


///////////////////////////////////////////////////////////////////////////////
//
//  Erase the property.
//
///////////////////////////////////////////////////////////////////////////////

bool Map::erase ( const std::string &name )
{
  Values::iterator i = _values.find ( name );
  if ( _values.end() != i )
  {
    _values.erase ( i );
    return true;
  }
  return false;
}


///////////////////////////////////////////////////////////////////////////////
//
//  Is there a property with this name?
//
///////////////////////////////////////////////////////////////////////////////

bool Map::has ( const std::string &name ) const
{
  return ( _values.end() != _values.find ( name ) );
}


///////////////////////////////////////////////////////////////////////////////
//
//  Insert the value.
//
///////////////////////////////////////////////////////////////////////////////

void Map::insert ( const std::string &name, const std::string &value )
{
  this->insert < std::string > ( name, value );
}
void Map::insert ( const std::string &name, const char *value )
{
  this->insert ( name, std::string ( value ) );
}
void Map::insert ( const std::string &name, std::nullptr_t value )
{
  this->insert < std::nullptr_t > ( name, value );
}


///////////////////////////////////////////////////////////////////////////////
//
//  Insert or update the value.
//
///////////////////////////////////////////////////////////////////////////////

void Map::update ( const std::string &name, const std::string &value )
{
  this->update < std::string > ( name, value );
}
void Map::update ( const std::string &name, const char *value )
{
  this->update ( name, std::string ( value ) );
}
void Map::update ( const std::string &name, std::nullptr_t value )
{
  this->update < std::nullptr_t > ( name, value );
}


} // namespace Properties
} // namespace Usul
