
///////////////////////////////////////////////////////////////////////////////
//
//  Copyright (c) 2019, Perry L Miller IV
//  All rights reserved.
//  MIT License: https://opensource.org/licenses/mit-license.html
//
///////////////////////////////////////////////////////////////////////////////

///////////////////////////////////////////////////////////////////////////////
//
//  Error-checking macros.
//
///////////////////////////////////////////////////////////////////////////////

#ifndef _USUL_ERRORS_CHECK_H_
#define _USUL_ERRORS_CHECK_H_

// Put these in the source files that actually use these macros.
// #include "Usul/Strings/Format.h"
// #include <iostream>
// #include <stdexcept>


///////////////////////////////////////////////////////////////////////////////
//
//  See if the index is in range.
//
///////////////////////////////////////////////////////////////////////////////

#define USUL_CHECK_INDEX_RANGE(size,index,message) \
{ \
  if ( ( index < 0 ) || ( index >= size ) ) \
  { \
    throw std::out_of_range ( message ); \
  } \
}


///////////////////////////////////////////////////////////////////////////////
//
//  Handle no message
//
///////////////////////////////////////////////////////////////////////////////

#ifdef _WIN32
# define USUL_GET_MESSAGE_OR_DEFAULT(message) ( message ? message : "Expression is false" )
#else
# define USUL_GET_MESSAGE_OR_DEFAULT(message) ( ( nullptr != message ) ? message : "Expression is false" )
#endif


///////////////////////////////////////////////////////////////////////////////
//
//  Throw an exception if the expression is false.
//
///////////////////////////////////////////////////////////////////////////////

#define USUL_CHECK_AND_THROW(expression,message) \
  if ( false == expression ) \
  { \
    throw std::runtime_error ( Usul::Strings::format ( \
      USUL_GET_MESSAGE_OR_DEFAULT ( message ), \
      ", File: ", __FILE__, \
      ", Line: ", __LINE__ \
    ) ); \
  }


///////////////////////////////////////////////////////////////////////////////
//
//  Log an error if the expression is false.
//
///////////////////////////////////////////////////////////////////////////////

#define USUL_CHECK_AND_LOG(expression,message)\
if ( false == expression ) \
{ \
  std::clog << ( Usul::Strings::format ( \
    USUL_GET_MESSAGE_OR_DEFAULT ( message ), \
    ", File: ", __FILE__, \
    ", Line: ", __LINE__ \
  ) ) << std::endl; \
}


///////////////////////////////////////////////////////////////////////////////
//
//  Set the default error checker.
//
///////////////////////////////////////////////////////////////////////////////

#define USUL_CHECK USUL_CHECK_AND_THROW


#endif // _USUL_ERRORS_CHECK_H_
