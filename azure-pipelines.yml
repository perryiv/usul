################################################################################
#
#  Azure Pipelines configuration file.
#
#  Pipeline results are here:
#
#    https://dev.azure.com/perryiv/usul
#
#  Resources:
#
#    https://docs.microsoft.com/en-us/azure/devops/pipelines/process/container-phases
#    https://docs.microsoft.com/en-us/azure/devops/pipelines/agents/hosted
#    https://medium.com/@brentrobinson5/containerised-ci-cd-pipelines-with-azure-devops-74064c679f20
#    https://github.com/conan-io/conan-docker-tools/blob/master/azure-pipelines.yml
#    https://jaylee.org/archive/2019/03/21/azure-devops-wasm-build-container.html
#    https://github.com/microsoft/azure-pipelines-agent/issues/2043
#    https://hub.docker.com/r/conanio/gcc8
#    https://hub.docker.com/_/microsoft-windows-servercore
#    https://github.com/jonico/libzengithub/blob/master/azure-pipelines.yml
#    https://docs.microsoft.com/en-us/azure/devops/pipelines/process/variables#secret-variables
#    https://docs.microsoft.com/en-us/azure/devops/pipelines/process/phases#timeouts
#
#  Notes:
#
#    -- When we run inside a container we use the latest OS for the host and
#       specify the version of the image.
#
#    -- When we run directly on the OS (e.g., Mac) we specify the OS version.
#
################################################################################

trigger:
- master

jobs:

- job: Linux_Job
  displayName: Linux
  timeoutInMinutes: 0
  strategy:
    matrix:
      gcc8:
        imageName: 'conanio/gcc8'
      gcc9:
        imageName: 'conanio/gcc9'
      gcc10:
        imageName: 'conanio/gcc10'
  pool:
    vmImage: 'ubuntu-latest'
  container:
    image: $[variables['imageName']]
    options: --user root
  steps:
  - script: sh scripts/configure_conan.sh
    displayName: Configure conan

- job: Windows_2019_VS_2019
  displayName: Windows 2019 VS 2019
  timeoutInMinutes: 0
  pool:
    vmImage: windows-2019
  steps:
  - task: ShellScript@2
    inputs:
      scriptPath: scripts/configure_conan.sh
    displayName: Configure conan

- job: Windows_2016_VS_2017
  displayName: Windows 2016 VS 2017
  timeoutInMinutes: 0
  pool:
    vmImage: vs2017-win2016
  steps:
  - task: ShellScript@2
    inputs:
      scriptPath: scripts/configure_conan.sh
    displayName: Configure conan

- job: Mac_10_15
  displayName: Mac 10.15
  timeoutInMinutes: 0
  pool:
    vmImage: macOS-10.15
  steps:
  - script: sh scripts/configure_conan.sh
    displayName: Configure conan

- job: Mac_10_14
  displayName: Mac 10.14
  timeoutInMinutes: 0
  pool:
    vmImage: macOS-10.14
  steps:
  - script: sh scripts/configure_conan.sh
    displayName: Configure conan
